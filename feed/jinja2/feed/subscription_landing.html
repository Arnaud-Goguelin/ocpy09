{% extends 'base.html' %}

{% from 'macros/form_macros.html' import render_field %}
{% from 'macros/button_macros.html' import action_button %}

{% block title %}
    Abonnements - LitReview
{% endblock %}

{% block css %}
    <link rel="stylesheet" href="{{ static('styles/components/button.css') }}">
    <link rel="stylesheet" href="{{ static('styles/components/form.css') }}">
{% endblock %}

{% block content %}
<section class="flex --column --align-start">
    <h2 class="headline-xl mb-lg">Gestion des abonnements</h2>

    <!-- Formulaire pour s'abonner -->
    <div class="mb-xl">
        <h3 class="headline-lg mb-md">Suivre un utilisateur</h3>
        <form class="form-global width-80" method="post">

            {{ csrf_input|safe }}
            {{ render_field(form.username, css_class="form-input") }}

            {% if form.non_field_errors() %}
                <div class="bold error-text mt-sm">
                    {% for error in form.non_field_errors() %}
                        <div>{{ error }}</div>
                    {% endfor %}
                </div>
            {% endif %}

            {{ action_button(primary_text="S'abonner") }}
        </form>
    </div>

    <!-- Liste des utilisateurs que je suis -->
    <div class="mb-xl">
        <h3 class="headline-lg mb-md">Mes abonnements</h3>
        {% if following %}
            <p>Vous suivez {{ following|length }} utilisateur·trice{% if following|length > 1 %}s{% endif %}.</p>
        {% endif %}
        <div>
            {% if not following %}
                <p>Vous ne suivez personne pour le moment.</p>
            {% else %}
                {% for subscription in following %}
                    <div class="flex --space-between --align-center mb-sm p-md border">
                        <span>{{ subscription.followed.username }}</span>
                    </div>
                {% endfor %}
            {% endif %}
        </div>
    </div>

    <!-- Liste de mes abonnés -->
    <div class="mb-xl">
        <h3 class="headline-lg mb-md">Mes abonnés</h3>
        {% if followers %}
            <p>{{ followers|length }} utilisateur·trice{% if following|length > 1 %}s{% endif %} vous suivent actuellement</p>
        {% endif %}
        <div>
            {% if not followers %}
                <p>Personne ne vous suit pour le moment.</p>
            {% else %}
                {% for subscription in followers %}
                    <div class="flex --space-between --align-center mb-sm p-md border">
                        <span>{{ subscription.follower.username }}</span>
                    </div>
                {% endfor %}
            {% endif %}
        </div>
    </div>
</section>
{% endblock %}
